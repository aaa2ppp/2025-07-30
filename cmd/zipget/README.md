# zipget - URL Validation and Archiving Utility

Консольная утилита для проверки работы загрузчика файлов. Проверяет доступность URL, валидирует типы файлов и создаёт ZIP-архивы с возможностью детального отчёта.

## Ключевые возможности
- Проверка URL через HEAD-запросы (`-n` режим)
- Скачивание и архивирование файлов в ZIP
- Поддержка форматов: PDF, JPEG, PNG
- Фильтрация по MIME-типам
- Генерация JSON-отчёта о статусе обработки
- Гибкие источники ввода: аргументы, файлы, stdin
- Настраиваемый вывод: файл или stdout

## Сборка
```sh
make            # Собрать все утилиты
make bin/zipget # Собрать только zipget
```

## Использование
```sh
bin/zipget [OPTIONS] [URL1 URL2 ...]
```

### Флаги
| Флаг | Описание |
|------|----------|
| `-u` | Файл с URL (по одному на строку), `-` для stdin |
| `-o` | Выходной ZIP-файл (обязателен для скачивания), `-` для stdout |
| `-s` | Файл для сохранения JSON-статуса, `-` для stdout |
| `-v` | Подробный режим (вывод статуса в stderr) |
| `-n` | Режим проверки без скачивания (только HEAD-запросы) |

### Примеры
1. **Проверка URL без скачивания:**
```sh
bin/zipget -n -s status.json \
  https://example.com/file1.jpg \
  https://example.com/file2.pdf
```

2. **Скачивание из файла со списком URL:**
```sh
bin/zipget -u urls.txt -o archive.zip
```

3. **Использование stdin:**
```sh
echo "https://example.com/image.png" | bin/zipget -u - -o images.zip
```

4. **Вывод статуса в консоль:**
```sh
bin/zipget -v -n https://broken.url
```

## Формат JSON-отчёта
Отчёт содержит массив объектов с информацией о каждом URL:
```json
[
  {
    "url": "https://example.com/file.jpg",
    "content_type": "image/jpeg",
    "real_type": "image/jpeg",
    "name": "file.jpg",
    "size": 10240,
    "status": 200,
    "error_msg": ""
  }
]
```

### Поля
- `url`: Оригинальный URL
- `content_type`: Заявленный Content-Type
- `real_type`: Определённый тип по сигнатуре файла
- `name`: Имя файла в архиве
- `size`: Размер файла (байты)
- `status`: HTTP-статус
- `error_msg`: Сообщение об ошибке (если есть)

## Ограничения
1. Поддерживаемые типы:
   - `application/pdf`
   - `image/jpeg`
   - `image/png`
2. Максимальная длина имени файла: 100 символов
3. Автоматическая санитизация имён файлов:
   - Удаление запрещённых символов (`<>:"/\|?*`)
   - Замена пробелов и спецсимволов на `-`
   - Защита от зарезервированных имён (CON, PRN и др.)

## Системные требования
- Go 1.24+
- Linux/macOS/MINGW64 (для скриптов тестирования)

